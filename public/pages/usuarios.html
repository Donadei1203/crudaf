<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netfrixo - Admin</title>
    <link rel="stylesheet" href="../styles/users.css">
</head>
<body>
    <header>
        <div>
        <img src="../img/logo.png" class="logo" alt="" width="150px">
        </div>

        <div>
        <a href="pages/cadastro.html"></a>
        <button onclick="logout()">Logout</button>
        </div>
    </header>

    <main>
        <!-- Parte Get -->
        <div class="table-container" >
            <h1>Controle de Usuários </h1>
            <br>
            <h1>Usuários Cadastrados</h1>
            <table border="1" class="tabela-users">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>CPF</th>
                        <th>Email</th>
                        <th>CEP</th>
                        <th>Cidade</th>
                        <th>Estado</th>
                        <th>Rua</th>
                        <th>Telefone</th>
                </tr>
            </thead>
            
            <tbody id="tabela-corpo" ></tbody>
        </table>
    </div>

    <div class="buscacpf">
        <p>Busca por CPF</p>
        <label for="cpfsearch">Busque o CPF aqui</label>
        <input type="text" id="cpfsearch" oninput="formatorg(this)" maxlength="14">
        <button type="button" onclick="buscarDados()">Procurar</button>

        <div class="displaycpf">

            <div>

                <label for="nome" style="letter-spacing: 2px;">Nome</label>
                <label for="senha" style="letter-spacing: 2px;">Senha</label>
                <label for="cpf" style="letter-spacing: 2px;">CPF</label>
                <label for="email" style="letter-spacing: 2px;">Email</label>
                <label for="cep" style="letter-spacing: 2px;">CEP</label>
                <label for="cidade" style="letter-spacing: 2px;">Cidade</label>
                <label for="estado" style="letter-spacing: 2px;">Estado</label>
                <label for="rua" style="letter-spacing: 2px;">Rua</label>
                <label for="telefone" style="letter-spacing: 3px;">Telefone</label>
            
        </div>
        <div>
            
            <input type="text" id="nome" required >
            <br>
            <input type="text" id="senha" required readonly>
            <br>
            <input type="text" id="cpf" maxlength="14" readonly>
            <br>
            <input type="email" id="email" required readonly>
            <br>
            <input type="text" id="cep" required maxlength="8">
            <br>
            <input type="text" id="cidade" required readonly>
            <br>
            <input type="text" id="estado" required readonly>
            <br>
            <input type="text" id="rua" required readonly>
            <br>
            <input type="text" id="telefone" required maxlength="11">
            
        </div>
    </div>
    <div class="botões">
        <button type="button" onclick="atualizarDados()">Editar</button>
        <button type="button" onclick="deletarDados()">Deletar</button>
    </div>
    
    </div>
</main>
</body>
<script src="../scripts/users.js"></script>
<script>
    
    function formatorg(input) {
      input.value = input.value
        .replace(/\D/g, '')                      // Remove tudo que não for dígito
        .replace(/(\d{3})(\d)/, '$1.$2')         // Coloca ponto após os 2 primeiros dígitos
        .replace(/(\d{3})(\d)/, '$1.$2')         // Coloca ponto após os 3 dígitos seguintes
        .replace(/(\d{3})(\d{1,2})$/, '$1-$2');  // Coloca hífen nos dois últimos dígitos
    }


    const preencherFormulario = (endereco) => {
            document.getElementById("rua").value = endereco.logradouro
            document.getElementById("cidade").value = endereco.localidade
            document.getElementById("estado").value = endereco.uf    
    }

     const CepValido = (cep) => {
            if (cep.length == 8) {
                return true;
            } else {
                return false;
            }
        }

        //Buscar API
        const pesquisaCep = async () => {
            const cep = document.getElementById("cep").value;
            const url = `https://viacep.com.br/ws/${cep}/json/`;
            if(CepValido(cep)) {
                const dados = await fetch(url);
                const endereco = await dados.json();
                preencherFormulario(endereco);
            }
        }
        document.getElementById("cep").addEventListener("focusout", pesquisaCep);

    
</script>
</html>